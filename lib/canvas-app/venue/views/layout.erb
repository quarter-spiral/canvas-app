<!DOCTYPE html>
<html lang="en-us" ng-app="canvasApp">
  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <title><%=h game.name %></title>
      <%= css :application, :media => 'screen' %>
      <%= css :vendor, :media => 'screen' %>
      <%= js :vendor %>
      <meta name="description" content="">
      <meta name="viewport" content="width=device-width">
  </head>
  <body>
    <div id="header" class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <div class="nav-collapse collapse">
            <ul class="nav">
                <li class="active"><a href="#"><%=h game.name %></a></li>
                <!--
                <li>
                    <form class="form-search navbar-form">
                        <input type="text" class="input-medium search-query span2" placeholder="Search Games..." />
                    </form>
                </li>
                -->
            </ul>

          </div><!--/.nav-collapse -->

          <div class="nav-collapse collapse pull-right">
              <ul class="nav">
                  <li class="dropdown">
                      <a href="#" class="dropdown-toggle" data-toggle="dropdown">Quarter Spiral <b class="caret"></b></a>
                      <ul class="dropdown-menu">
                          <li class="nav-header">Spiral Galaxy</li>
                          <li><a href="#">Open Spiralgalaxy.com </a></li>
                          <li><a href="#">Your Game Library</a></li>
                          <li><a href="#">Your Public Profile</a></li>
                          <li class="divider"></li>
                          <li class="nav-header">Quarter Spiral ID</li>
                          <li><a href="#">Your Account</a></li>
                      </ul>
                  </li>
              </ul>
          </div><!--/.nav-collapse -->

        </div>
      </div>
    </div>

    <div id="mainView">

      <div id="game">

        <%= embedded_game %>

      </div>


      <div id="socialBar" ng-Controller="SocialController">
        <ul class="options">
        <!--
            <li><a ng-click="toggleFriendFilter();"><i class="icon-ok" ng-class="{'icon-white': searchFriends.online == true}"></i> Online Only</a></li>
        -->
            <li><a ng-click="sortFriends = 'fullName'"><i class="icon-ok" ng-class="{'icon-white': sortFriends == 'fullName'}"></i> Sort by Name</a></li>

            <li ng-show="friendbarValues.top.label"><a ng-click="sortFriends = 'meta.top.value'"><i class="icon-ok" ng-class="{'icon-white': sortFriends == 'meta.top.value'}"></i> Sort by {{friendbarValues.top.label}}</a></li>

            <li ng-show="friendbarValues.bottom"><a ng-click="sortFriends = 'meta.bottom.value'"><i class="icon-ok" ng-class="{'icon-white': sortFriends == 'meta.bottom.value'}"></i> Sort by {{friendbarValues.bottom.label}}</a></li>
          <li><input type="text" ng-model="searchFriends.$" class="span2 input-mini" placeholder="Search... " ></li>
        </ul>
        <ul class="avatars">
          <li ng-repeat="friend in friends | filter:searchFriends | orderBy:sortFriends">
            <div class="name">{{friend.fullName}}</div>
            <div ng-show="!!friend.meta.top.value" class="top-value level" title="{{friend.meta.top.label}}">{{friend.meta.top.value}}</div>
            <div ng-show="!!friend.meta.bottom.value" class="bottom-value xp" title="{{friend.meta.bottom.label}}">{{friend.meta.bottom.value}}</div>
            <img src="{{friend.avatar}}" />
          </li>
        </ul>
      </div>


    </div>

    <%= yield %>

    <script type="text/javascript">
      if (window.qs === undefined) {
        window.qs = {}
      }
      window.qs.tokens = <%= tokens.to_json %>;
      window.qs.info = {
        game: <%= game.uuid.to_json %>,
        venue: <%= venue.to_json %>,
        uuid: <%= uuid.to_json %>,
        friendbar: {
          <% values = {} %>
          <% if label = game.configuration['friendbarTopValueLabel'] and key = game.configuration['friendbarTopValueKey'] and !label.empty? and !key.empty? %>
            <% values['top'] = {'label' => label, 'key' => key, 'default' => game.configuration['friendbarTopValueDefault']} %>
          <% end %>
          <% if label = game.configuration['friendbarBottomValueLabel'] and key = game.configuration['friendbarBottomValueKey'] and !label.empty? and !key.empty? %>
            <% values['bottom'] = {'label' => label, 'key' => key, 'default' => game.configuration['friendbarBottomValueDefault']} %>
          <% end %>
          values: <%= values.to_json %>
        }
      };
    </script>

    <!-- Angular must be included before these -->
    <script src="/angular-commons/javascripts/envs.js"></script>
    <script src="/angular-commons/javascripts/services.js"></script>
    <script src="/angular-commons/javascripts/controllers.js"></script>
    <%= js :app %>
  </body>
</html>

